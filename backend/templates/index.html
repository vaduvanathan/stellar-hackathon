<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Walletsurance</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect fill='%23238636' width='32' height='32' rx='6'/><path fill='%23fff' d='M16 6l2 6h6l-5 4 2 6-5-4-5 4 2-6-5-4h6z'/></svg>" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,600;1,9..40,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --border: #30363d;
      --text: #e6edf3;
      --muted: #8b949e;
      --accent: #3fb950;
      --accent-dim: #238636;
      --warn: #d29922;
      --err: #f85149;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', system-ui, sans-serif;
      font-size: 15px;
      line-height: 1.6;
    }
    .wrap { max-width: 560px; margin: 0 auto; padding: 2rem 1rem; }
    h1 {
      font-size: 1.75rem;
      font-weight: 600;
      margin: 0 0 0.25rem 0;
      letter-spacing: -0.02em;
    }
    .tagline { color: var(--muted); font-size: 0.9rem; margin-bottom: 2rem; }
    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.25rem 1.5rem;
      margin-bottom: 1.25rem;
    }
    .card h2 { font-size: 0.95rem; font-weight: 600; margin: 0 0 0.75rem 0; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; }
    .status-row { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
    .status-row:last-child { margin-bottom: 0; }
    .dot { width: 8px; height: 8px; border-radius: 50%; }
    .dot.ok { background: var(--accent); }
    .dot.no { background: var(--muted); }
    .dot.warn { background: var(--warn); }
    code, .mono { font-family: 'JetBrains Mono', monospace; font-size: 0.85em; background: rgba(255,255,255,0.06); padding: 0.15em 0.4em; border-radius: 4px; word-break: break-all; }
    label { display: block; margin-bottom: 0.35rem; color: var(--muted); font-size: 0.85rem; }
    input[type="text"], input[type="email"] {
      width: 100%;
      padding: 0.6rem 0.75rem;
      margin-bottom: 0.9rem;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-family: inherit;
      font-size: 0.95rem;
    }
    input::placeholder { color: var(--muted); }
    input:focus { outline: none; border-color: var(--accent); }
    button {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 0.6rem 1.1rem;
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { background: var(--accent-dim); }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    button.secondary { background: var(--surface); color: var(--text); border: 1px solid var(--border); }
    button.secondary:hover { border-color: var(--muted); }
    .msg { margin-top: 0.75rem; font-size: 0.9rem; padding: 0.5rem 0; }
    .msg.ok { color: var(--accent); }
    .msg.err { color: var(--err); }
    .loading { color: var(--muted); }
    footer { margin-top: 2.5rem; text-align: center; color: var(--muted); font-size: 0.8rem; }
    footer a { color: var(--accent); text-decoration: none; }
    a.btn { display: inline-block; background: var(--accent); color: #fff; padding: 0.6rem 1.1rem; border-radius: 8px; font-weight: 600; text-decoration: none; }
    a.btn:hover { background: var(--accent-dim); color: #fff; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Walletsurance</h1>
    <p class="tagline">When you’re inactive, your nominee gets an SMS and can claim your entire wallet.</p>

    <section class="card" id="nominee-section">
      <h2>Set up nominee (SMS when you’re inactive)</h2>
      <p style="margin: 0 0 0.75rem 0; color: var(--muted); font-size: 0.9rem;">Your funds <strong>stay in your Stellar account</strong> — nothing is locked in a contract. You create a <strong>secondary (sweep) key</strong>, add it as a co-signer to your account, and register a nominee. When you have <strong>no activity</strong> for the set period, we send an <strong>SMS</strong> with a claim link. Your nominee answers a secret question and can then sweep <strong>the entire balance</strong> to their address.</p>
      <a href="/nominee" class="btn">Create secondary key &amp; register nominee</a>
      <p style="margin: 1rem 0 0.5rem 0; font-size: 0.85rem; color: var(--muted);">Already set up? Run the inactivity check and send SMS to nominees:</p>
      <button type="button" id="check-nominees-btn" class="secondary" style="margin-top:0.25rem;">Check nominees &amp; send SMS</button>
      <div id="check-nominees-msg" class="msg"></div>
    </section>

    <section class="card" id="get-account">
      <h2>How to get a Stellar account</h2>
      <ol style="margin:0;padding-left:1.25rem;color:var(--muted);font-size:0.9rem;line-height:1.8;">
        <li>Open <a href="https://laboratory.stellar.org/#account-creator?network=test" target="_blank" rel="noopener" style="color:var(--accent);">Stellar Laboratory – Account Creator</a> (Test network).</li>
        <li>Click <strong>Generate keypair</strong>. Copy your <strong>Public key</strong> (G…) and <strong>Secret key</strong> (S…). Keep the secret safe.</li>
        <li>Paste your public key in the box and click <strong>Fund account</strong> to get test XLM from Friendbot.</li>
        <li>Use the <strong>Public key</strong> (G…) as your account when you create a secondary key and register a nominee above.</li>
      </ol>
      <p style="margin:0.75rem 0 0;font-size:0.85rem;color:var(--muted);">Or fund via URL: <code>https://friendbot.stellar.org/?addr=YOUR_PUBLIC_KEY</code></p>
    </section>

    <footer>
      Stellar Build-A-Thon Chennai · <a href="https://github.com/vaduvanathan/stellar-hackathon">GitHub</a>
    </footer>
  </div>

  <script>
    const api = (path, opts = {}) => fetch(path, { headers: { 'Content-Type': 'application/json', ...opts.headers }, ...opts });

    document.getElementById('check-nominees-btn').addEventListener('click', async () => {
      const msg = document.getElementById('check-nominees-msg');
      msg.textContent = 'Checking inactivity & sending SMS…';
      msg.className = 'msg loading';
      try {
        const r = await api('/api/agent/check-nominees', { method: 'POST' });
        const d = await r.json().catch(() => ({}));
        if (r.ok) {
          msg.textContent = d.message || ('SMS sent: ' + (d.sms_sent ?? 0));
          msg.className = 'msg ok';
        } else {
          msg.textContent = d.error || 'Check failed. Try again.';
          msg.className = 'msg err';
        }
      } catch (e) {
        msg.textContent = e.message || 'Network error. Try again.';
        msg.className = 'msg err';
      }
    });
  </script>
</body>
</html>
